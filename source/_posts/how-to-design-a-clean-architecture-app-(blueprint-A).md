---
title: 如何设计一个架构清晰的App-画饼篇（上）
date: 2022-02-28 22:17:25
category: "程序设计"
tags: [clean architecture]
---

# 如何提高客户端项目扩展能力

## 初心

如何使项目具有高扩展性？

能否把项目改造成像vscode、chrome、操作系统一样模块可以热插拔？

如何避免在屎山上雕花？

面对越来越多的AB Test，是否还再给嵌套了N层的if else里再小心翼翼的添加一段分支？

高内聚、低耦合都已经听烂了，究竟如何落地？

如何在10年以上的大型项目中进行重构？

如何在单周发版的节奏下稳健的重构？

## 痴心

其实每一个客户端开发都有一个梦想：

设计一套框架，包含各种基础组件、服务，完全业务无关，能应对各种复杂的业务场景。

要新搭App，直接基于这套框架，在上面铺业务、画UI，避免从零开始写App

某厂称其为 App中台、App工厂

## 真心

话说都2202年了，**客三消**都变成了**客零消**，还折腾这些干啥？

把一个10余年、200w+行代码的老项目改造成理想的架构有什么收益？

就为了理想？为了情怀？

~~为了创造就业岗位、为了晋升~~

前面说到，每个开发同学心中都有梦想，但实际情况是开发的梦想并不重要，重要的是产品的、老板的梦想，dddd

而产品、老板的梦想：

今天的想法明天是否能上线？
一周后是否能看到数据？
能否一周做出新app原型，三周达到上线水平？

开发同学和产品、老板的梦想看似没有直接关系，甚至是冲突的（因为重构可能投入大量的人力和时间成本，挤占业务开发资源）

如何解决这一问题？

做为职场老（油）司（条）机，需要做的就是向老板解（忽）释（悠），我们的目标是一致的

按照老板梦想和要求，我们可以提炼出几个关键点：

 - 快速迭代
 - 快速实验
 - 快速孵化

为达到以上目标，我们逐个拆解

首先是快速迭代

### 迭代速度慢的原因是什么？

项目总体进度慢，原因可能有很多，如研发人力不足，上下游依赖较多、链条较长。
我们重点关注研发侧问题，下同

1. 日常开发慢
   1. 编译速度慢
   2. 调试慢
   3. 单测慢
2. 新写业务慢
   1. 旧代码设计不够好，不能复用
   2. 缺乏有效的模板，无法低成本搭建
   3. 代码涉及跨团队，没有feature小组内闭合
3. 出了bug排查慢、解决慢
   1. 业务模块间耦合严重，改一处代码引起其他模块bug
   2. 缺乏合理的分层
4. 没有充足的开发时间
   1. 会议较多
   2. 沟通较多
   3. 当客服
   4. 救火、排查线上紧急问题
   
   
其次是快速实验

### 为什么不能快速实验？

1. 实验需要预埋，App动态能力不足以支撑，需要跟随版本节奏
2. 涉及实验的修改点改动大，UI组件与业务逻辑耦合紧密，无法充分复用
3. 实验条件复杂，旧实验不能快速下线，导致实验条件、实验分支异常复杂


最后是快速孵化新产品

### 为什么不能快速孵化新产品？

1. 现有app没有把业务层与基础能力层分离，业务代码深入基础组件，无法直接复用
2. 


上述这些问题，最终都指向了App项目缺乏良好设计。
开发同学每天在这样的环境下，生产效率和积极性也严重受损。

开发效率低下   =>   追赶进度  => 没有时间设计   =>   代码腐烂   =>   bug多

=> 经常救火，排查紧急问题  => 追赶进度

陷入恶性循环中。

### 解决方案

我们需要对腐烂代码进行有效的重构，减少腐烂的代码。

先把一大坨💩山，分解成若干坨小的💩山，跟每个小的💩山划清界限，不要相互污染，加剧腐烂。

#### 模块化改造

#### 模块间的通信

#### 模块的更新